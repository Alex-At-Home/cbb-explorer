#================================ Input =====================================

filebeat.inputs:
  - type: log
    close_eof: ${CLOSE_EOF}
    enabled: true
    paths:
      - ./men_playerproc_*_all.ndjson
      - ./women_playerproc_*_all.ndjson

    fields:
      sample_name: "all"
    fields_under_root: true
    json.keys_under_root: true
    json.document_id: "_id"

  - type: log
    close_eof: ${CLOSE_EOF}
    enabled: true
    paths:
      - ./men_playerproc_*_conf.ndjson
      - ./women_playerproc_*_conf.ndjson

    fields:
      sample_name: "conf"
    fields_under_root: true
    json.keys_under_root: true
    json.document_id: "_id"

  - type: log
    close_eof: ${CLOSE_EOF}
    enabled: true
    paths:
      - ./men_playerproc_*_t100.ndjson
      - ./women_playerproc_*_t100.ndjson

    fields:
      sample_name: "t100"
    fields_under_root: true
    json.keys_under_root: true
    json.document_id: "_id"

  - type: log
    close_eof: ${CLOSE_EOF}
    enabled: true
    paths:
      - ./men_playerproc_*_lowvol.ndjson
      - ./women_playerproc_*_lowvol.ndjson

    fields:
      sample_name: "lowvol"
    fields_under_root: true
    json.keys_under_root: true
    json.document_id: "_id"

#================================ Processing =====================================
# Make it so that existing docs will be updated, to avoid deleting/recreating every day

processors:
  - add_fields:
      target: ""
      fields:
        temp_op_type: "index"
  - convert:
      fields:
        - from: temp_op_type
          to: "@metadata.op_type"
          type: string
  - drop_fields:
      fields: ["temp_op_type"]

#================================ Output =====================================

setup.ilm.enabled: false

cloud.id: "${ELASTIC_CLOUD_ID:?ELASTIC_CLOUD_ID}"
cloud.auth: "${ELASTIC_USER:?ELASTIC_USER}:${ELASTIC_PASS:?ELASTIC_PASS}"

output.elasticsearch:
  indices:
    # Just check a ping/pong var is set:
    - index: "test_playerproc_${PING:?PING=ping-or-pong}"
      when.regexp:
        log.file.path: "DUMMY_PATTERN_JUST_ERROR_CHECKING"

    # Player 360s:

    # Men and women
    - index: "hoopexp_men_players_%{[year]}_${PING}"
      when.regexp:
        log.file.path: ".*/men_playerproc_[0-9]+(_.*)?.ndjson"

    - index: "hoopexp_women_players_%{[year]}_${PING}"
      when.regexp:
        log.file.path: ".*/women_playerproc_[0-9]+(_.*)?.ndjson"

setup.template.enabled: false

#================================ Logging =====================================

# Sets log level. The default log level is info.
# Available log levels are: error, warning, info, debug
logging.level: info
